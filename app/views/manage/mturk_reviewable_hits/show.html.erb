<% @title ||= 'HIT review'; title @title %>

<div class="row mb-5">
  <div class="col-12">
    <%= link_to mturk_reviewable_hits_path, class: 'btn btn-secondary btn-lg' do %>
      Go back
    <% end %>
  </div>
</div>

<div class="row justify-content-center mb-4">
  <div class="col-12 col-md-10 col-lg-8">
    <h2 class='mb-4'>Review individual HIT</h2>
  </div>
</div>

<% if @assignment_not_found %>
  <div class="row justify-content-center mb-5">
    <div class="col-12 col-md-8">
      <div class='alert alert-danger'>Assignment could not be retrieved</div>
    </div>
  </div>
<% end %>
<% if @task_not_found %>
  <div class="row justify-content-center mb-5">
    <div class="col-12 col-md-8">
      <div class='alert alert-danger'>Task for assignment could not be found</div>
    </div>
  </div>
<% end %>
<% if not @assignment_not_found and not @task_not_found %>
  <div class="row justify-content-center mb-5">
    <div class="col-12 col-md-8">
      <table class="table vertical-align">
        <col width="250px"/>
        <col />

        <tr>
          <td><h4>HIT id</h4></td>
          <td><%= @hit_id %></td>
        </tr>
        <tr>
          <td><h4>Assignment status</h4></td>
          <td><%= @status %></td>
        </tr>
        <tr>
          <td><h4>Worker id</h4></td>
          <td><%= @task.mturk_worker&.worker_id %></td>
        </tr>
        <tr>
          <td><h4>Num results</h4></td>
          <td><%= @task.results.count %></td>
        </tr>
        <tr>
          <td><h4>Total time spent (s)</h4></td>
          <td><%= @log[:totalDurationUntilMturkSubmit].to_i/1000.0 if @log.has_key?('totalDurationUntilMturkSubmit') %></td>
        </tr>
        <tr>
          <td><h4>Full log</h4></td>
          <td><pre style="font: 14px Inconsolata, monospace;"><%= JSON.pretty_generate(@log).strip %></pre></td>
        </tr>
      </table>
    </div>
  </div>

  <% if @status == 'Submitted' %>
    <div class="row justify-content-center mb-5">
      <div class="col-12 col-md-8">
        <%= simple_form_for(:hit, url: mturk_reviewable_hit_accept_path(@assignment_id)) do |f| %>
          <div class="form-group">
            <%= f.input :message, label: 'Acceptance message', as: :text, hint: 'Write a acceptance message to the worker', input_html: {value: @default_accept_message, rows: 3} %>
          </div>
          <div class="form-actions">
            <%= submit_tag 'Accept', class: 'btn btn-primary btn-lg' %>
          </div>
        <% end %>
      </div>
    </div>
    <div class="row justify-content-center mb-5">
      <div class="col-12 col-md-8">
        <%= simple_form_for(:hit, url: mturk_reviewable_hit_reject_path(@assignment_id)) do |f| %>
          <div class="form-group">
            <%= f.input :message, label: 'Rejection message', as: :text, hint: 'Write a rejection message to the worker', input_html: {value: @default_reject_message, rows: 3} %>
          </div>
          <div class="form-actions">
            <%= submit_tag 'Reject', class: 'btn btn-primary btn-negative btn-lg' %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>

