<% @title ||= 'ML models'; title @title %>
<%= go_back_btn dashboard_path, mb: 'mb-6' %>

<div class="row justify-content-center mb-4">
  <div class="col-12">
    <h2 class='mb-4'>ML Models</h2>
  </div>
</div>

<div class="row justify-content-center mt-5">

  <% if @api_ready %>
    <div class="col-12 mb-4">
      <table class="table">
        <thead>
          <tr class='no-wrap'>
            <th>Name</th>
            <th>Created at</th>
            <th>Project</th>
            <th>Question tag</th>
            <th>Endpoint status</th>
            <th>Endpiont action</th>
            <th>Pipeline status</th>
            <th>Pipeline action</th>
          </tr>
        </thead>
        <tbody>
          <% @models.each do |model| %>
            <tr>
              <td><%= model['ModelName'] %></td>
              <td><%= time_ago(DateTime.parse(model['CreationTime'])) %></td>
              <td><%= model['Tags']['project_name'] %></td>
              <td><%= model['Tags']['question_tag'] %></td>
              <td>
                <% if model['EndpointStatus'].present? %>
                  <span class='badge badge-sentiment'><%= endpoint_status(model['EndpointStatus']) %></span>
                <% end %>
              </td>
              <td>
                <% if model['EndpointStatus'] == 'InService' %>
                  <%= link_to 'Delete endpoint', delete_endpoint_ml_resources_path(model_name: model['ModelName']), method: :post %>
                <% elsif model['EndpointStatus'].nil? %>
                  <%= link_to 'Create endpoint', create_endpoint_ml_resources_path(model_name: model['ModelName']), method: :post%>
                <% end %>
              </td>
              <td>
                <% if model['ActiveEndpoint'] %>
                  <span class='badge badge-success'>Active</span>
                <% else %>
                  <span class='badge badge-light'>Inactive</span>
                <% end %>
              </td>
              <td>
                <% if model['Tags']['project_name'].present? %>
                  <% if model['ActiveEndpoint'] %>
                      <%= link_to 'Deactivate', deactivate_endpoint_ml_resources_path(model_name: model['ModelName'], project_name: model['Tags']['project_name']), method: :post %>
                  <% else %>
                    <% if model['EndpointStatus'] == 'InService' %>
                      <%= link_to 'Activate', activate_endpoint_ml_resources_path(model_name: model['ModelName'], project_name: model['Tags']['project_name']), method: :post %>
                    <% end %>
                  <% end %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="col-12">
      <div class="alert alert-primary">Could not reach API.</div>
    </div>
  <% end %>
</div>
